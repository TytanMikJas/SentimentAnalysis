schema: '2.0'
stages:
  process_data:
    cmd: python scripts/process_data.py data/raw_data data/processed_data/dataset.pkl
    deps:
    - path: data/raw_data
      hash: md5
      md5: 1879a37ccfe89870a8e73238e331f4ac.dir
      size: 524018363
      nfiles: 6
    - path: scripts/process_data.py
      hash: md5
      md5: 1401ece579631c4e35dea6e31c6ed52c
      size: 1953
      isexec: true
    params:
      params.yaml:
        process_data.cols_to_delete:
        - product_id
        - brand_id
        - variation_type
        - variation_value
        - variation_desc
        - author_id
        - submission_time
        - skin_tone
        - eye_color
        - skin_type
        - hair_color
        - product_id
        - 'Unnamed: 0'
        process_data.cols_to_fix:
        - total_feedback_count
        - total_pos_feedback_count
        process_data.review_text_column: review_text
    outs:
    - path: data/processed_data/dataset.pkl
      hash: md5
      md5: ef1694875461e8eac534d92fe25d57b5
      size: 624919680
  split_data:
    cmd: python scripts/split_data.py data/preprocessed_data/preprocessed_dataset.pkl
      data/train_test_data
    deps:
    - path: data/preprocessed_data/preprocessed_dataset.pkl
      hash: md5
      md5: 29589c31bba9f39bab5f774343119099
      size: 415065133
    - path: scripts/split_data.py
      hash: md5
      md5: c735dfadc84760d669341093a005b71d
      size: 1179
      isexec: true
    params:
      params.yaml:
        split_data.label_column: LABEL-rating
        split_data.stratify: true
        split_data.test_size: 0.15
    outs:
    - path: data/train_test_data/test.pkl
      hash: md5
      md5: 21952518d8cb522cd796c4645a5d1dab
      size: 62388548
    - path: data/train_test_data/train.pkl
      hash: md5
      md5: ed8b0518eb65ab6827a72f49fda10f54
      size: 352826825
  eval_model:
    cmd: python scripts/eval_model.py data/train_test_data metrics.json
    deps:
    - path: data/train_test_data/test.pkl
      hash: md5
      md5: 21952518d8cb522cd796c4645a5d1dab
      size: 62388548
    - path: data/train_test_data/train.pkl
      hash: md5
      md5: ed8b0518eb65ab6827a72f49fda10f54
      size: 352826825
    - path: scripts/eval_model.py
      hash: md5
      md5: 02f54bfad490c26bd8f738f70da165e2
      size: 3642
      isexec: true
    params:
      params.yaml:
        features.categorical:
        - limited_edition
        - new
        - online_only
        - out_of_stock
        - sephora_exclusive
        - contains_refund
        - product_name
        - brand_name
        - primary_category
        - secondary_category
        features.dim_red_method: svd
        features.dim_reduction: false
        features.highlights: highlights
        features.n_components: 145
        features.numerical:
        - total_feedback_count
        - helpfulness
        - total_neg_feedback_count
        - total_pos_feedback_count
        - price_usd
        - loves_count
        - rating
        - reviews
        - child_count
        - review_length
        - exclamation_count
        - unique_word_count
        features.selected:
        - limited_edition
        - online_only
        - out_of_stock
        - sephora_exclusive
        - contains_refund
        - product_name
        - brand_name
        - primary_category
        - secondary_category
        - helpfulness
        - price_usd
        - loves_count
        - rating
        - reviews
        - review_length
        - exclamation_count
        - review_text
        - review_title
        - highlights
        - LABEL-rating
        features.text:
        - review_text
        - review_title
    outs:
    - path: metrics.json
      hash: md5
      md5: f37cbb0d69b84e4ffa09498ce0ee257e
      size: 627
  execute_notebook:
    cmd: papermill notebooks/Lab4.ipynb data/notebooks/Lab4.ipynb
    deps:
    - path: data/processed_data/dataset.pkl
      hash: md5
      md5: ef1694875461e8eac534d92fe25d57b5
      size: 624919680
    - path: notebooks/Lab4.ipynb
      hash: md5
      md5: 888aa9c4e8c9f94683cd8673966b6ac5
      size: 17061
      isexec: true
    outs:
    - path: data/notebooks/Lab4.ipynb
      hash: md5
      md5: 458651d6585b98cb9ef671de5d26744c
      size: 736615
  preprocess_data:
    cmd: python scripts/preprocess_data.py data/processed_data/dataset.pkl data/preprocessed_data/preprocessed_dataset.pkl
    deps:
    - path: data/processed_data/dataset.pkl
      hash: md5
      md5: ef1694875461e8eac534d92fe25d57b5
      size: 624919680
    - path: scripts/preprocess_data.py
      hash: md5
      md5: 4e40563cabb572b9542eacc8ac0c1697
      size: 3535
      isexec: true
    params:
      params.yaml:
        preprocess_data.cols_to_delete:
        - value_price_usd
        - sale_price_usd
        - child_max_price
        - child_min_price
        - tertiary_category
        - size
        - ingredients
    outs:
    - path: data/preprocessed_data/preprocessed_dataset.pkl
      hash: md5
      md5: 29589c31bba9f39bab5f774343119099
      size: 415065133
